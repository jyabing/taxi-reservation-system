{# âœ… éƒ¨åˆ†æ¨¡æ¿ï¼šæ˜¾ç¤ºæˆ‘çš„é¢„çº¦æŒ‰é’®ä¸çŠ¶æ€ #}

{% if r.status == 'pending' %}
  <a href="{% url 'edit_reservation' r.id %}">âœï¸ ä¿®æ”¹</a> |
  <a href="javascript:void(0);" onclick="confirmDelete('{{ r.id }}', '{{ r.vehicle.license_plate }}', '{{ r.date }}', '{{ r.start_time }}')">âŒ åˆ é™¤</a>
{% elif r.status == 'reserved' and not r.actual_departure %}
  <a href="{% url 'edit_reservation' r.id %}">âœï¸ ä¿®æ”¹</a> |
  <a href="javascript:void(0);" onclick="confirmDelete('{{ r.id }}', '{{ r.vehicle.license_plate }}', '{{ r.date }}', '{{ r.start_time }}')">âŒ åˆ é™¤</a>
  {% if today == r.date %}
    <button onclick="confirmDeparture('{{ r.id }}')">ğŸš— å‡ºåº“</button><br>
    <span style="color:gray;">âš ï¸ æœªå‡ºåº“çš„é¢„çº¦å°†åœ¨å¼€å§‹åä¸€å°æ—¶è‡ªåŠ¨å–æ¶ˆ</span>
  {% else %}
    <span style="color:gray;">â³ ç­‰å¾…é¢„çº¦æ—¥æœŸ</span>
  {% endif %}
{% elif r.status == 'reserved' and r.actual_departure and not r.actual_return %}
  <button onclick="confirmReturn('{{ r.id }}')">ğŸ…¿ï¸ å…¥åº“</button><br>
  <span style="color:gray;">âš ï¸ è¶…è¿‡30åˆ†é’Ÿæœªå…¥åº“å°†è‡ªåŠ¨å»¶é•¿</span>
  {% if request.user.is_staff %}
    <br><a href="{% url 'admin_reset_departure' r.id %}">ğŸ” æ’¤é”€å‡ºåº“</a>
  {% endif %}
{% elif r.status == 'out' and not r.actual_return %}
  <button onclick="confirmReturn('{{ r.id }}')">ğŸ…¿ï¸ å…¥åº“</button>
  {% if request.user.is_staff %}
    <br><a href="{% url 'admin_reset_departure' r.id %}">ğŸ” æ’¤é”€å‡ºåº“</a>
  {% endif %}
{% elif r.status == 'canceled' %}
  âŒ å·²å–æ¶ˆ
{% elif r.status == 'completed' %}
  âœ… å®Œæˆ
  {% if request.user.is_staff %}
    <br><a href="{% url 'admin_reset_return' r.id %}">ğŸ” æ’¤é”€å…¥åº“</a>
  {% endif %}
{% else %}
  â€”
{% endif %}


<script>
function confirmDeparture(reservationId) {
  const confirmed = confirm("ğŸš— ç¡®å®šç°åœ¨å°±ç™»è®°â€œå‡ºåº“â€å—ï¼Ÿè¯·ç¡®è®¤ä½ å·²å‡†å¤‡å¥½å‘è½¦ã€‚");
  if (confirmed) {
    openTimePopup(reservationId, 'departure');
  }
}

function confirmReturn(reservationId) {
  const confirmed = confirm("ğŸ…¿ï¸ ç¡®å®šç°åœ¨å°±ç™»è®°â€œå…¥åº“â€å—ï¼Ÿè¯·ç¡®è®¤ä½ å·²å®Œæˆå½’è¿˜è½¦è¾†ã€‚");
  if (confirmed) {
    openTimePopup(reservationId, 'return');
  }
}
</script>
