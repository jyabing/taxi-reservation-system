{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block content %}
<h2>ğŸ“‹ æˆ‘çš„é¢„çº¦è®°å½•</h2>

<table border="1">
  <tr>
    <th>è½¦è¾†</th>
    <th>æ—¶é—´æ®µ</th>
    <th>çŠ¶æ€</th>
    <th>æ“ä½œ</th>
  </tr>

  {% for r in reservations %}
  <tr>
    <td>{{ r.vehicle.license_plate }}</td>
    <td>
      {% include 'partials/_time_range_snippet.html' with obj=r %}
    </td>
    <td>{{ r.get_status_display }}</td>
    <td>
      {% if r.status == 'pending' %}
        <a href="{% url 'edit_reservation' r.id %}">âœï¸ ä¿®æ”¹</a> |
        <a href="{% url 'delete_reservation' r.id %}">âŒ åˆ é™¤</a>

      {% elif r.status == 'reserved' %}
        {% if not r.actual_departure %}
          {% if today == r.date %}
            <button onclick="openTimePopup('{{ r.id }}', 'departure')">
              ğŸš— å‡ºåº“
            </button><br>
            <span style="color:gray;">
              âš ï¸ æœªå‡ºåº“çš„é¢„çº¦å°†åœ¨å¼€å§‹åä¸€å°æ—¶è‡ªåŠ¨å–æ¶ˆ
            </span>
          {% else %}
            <span style="color:gray;">â³ ç­‰å¾…é¢„çº¦æ—¥æœŸ</span>
          {% endif %}
        {% elif not r.actual_return %}
          <button onclick="openTimePopup('{{ r.id }}', 'return')">
            ğŸ…¿ï¸ å…¥åº“
          </button><br>
          <span style="color:gray;">
            âš ï¸ è¶…è¿‡30åˆ†é’Ÿæœªå…¥åº“å°†è‡ªåŠ¨å»¶é•¿
          </span>
        {% else %}
          âœ… å‡ºå…¥åº“å®Œæˆ
        {% endif %}

      {% elif r.status == 'out' %}
        {% if not r.actual_return %}
          <button onclick="openTimePopup('{{ r.id }}', 'return')">
            ğŸ…¿ï¸ å…¥åº“
          </button>
        {% else %}
          âœ… å®Œæˆ
        {% endif %}

      {% elif r.status == 'canceled' %}
        âŒ å·²å–æ¶ˆ

      {% else %}
        -
      {% endif %}
    </td>
  </tr>
  {% empty %}
  <tr>
    <td colspan="4">æš‚æ— é¢„çº¦è®°å½•</td>
  </tr>
  {% endfor %}
</table>

{# åªåœ¨é¡µé¢åº•éƒ¨ include ä¸€æ¬¡ popup partial #}
{% include 'partials/_check_io_popup.html' %}

<style>
  .pagination {
    margin-top: 20px;
    text-align: center;
  }
  .pagination .step-links a,
  .pagination .step-links span {
    display: inline-block;
    margin: 0 5px;
    padding: 6px 12px;
    text-decoration: none;
    border: 1px solid #ccc;
    border-radius: 5px;
    color: #333;
    background-color: #f9f9f9;
    transition: background-color 0.2s, color 0.2s;
  }
  .pagination .step-links a:hover {
    background-color: #4CAF50;
    color: white;
    border-color: #4CAF50;
  }
  .pagination .current-page {
    background-color: #4CAF50;
    color: white;
    font-weight: bold;
    border-color: #4CAF50;
  }

    #tip-text {
    display: inline-block;
    opacity: 1;
    transition: opacity 0.5s ease-in-out;
  }

  .fade-out {
    opacity: 0;
  }

  .fade-in {
    opacity: 1;
  }
</style>

<div class="pagination">
  <span class="step-links">
    {% if page_obj.has_previous %}
      <a href="?page=1">&laquo; ç¬¬ä¸€é¡µ</a>
      <a href="?page={{ page_obj.previous_page_number }}">ä¸Šä¸€é¡µ</a>
    {% endif %}

    <span class="current-page">ç¬¬ {{ page_obj.number }} é¡µ / å…± {{ page_obj.paginator.num_pages }} é¡µ</span>

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}">ä¸‹ä¸€é¡µ</a>
      <a href="?page={{ page_obj.paginator.num_pages }}">æœ€åä¸€é¡µ &raquo;</a>
    {% endif %}
  </span>
</div>

<p><a href="{% url 'reservation_dashboard' %}">â† è¿”å›é¢„çº¦èœå•</a></p>

{% include 'partials/tip_box.html' %}

{% endblock %}
