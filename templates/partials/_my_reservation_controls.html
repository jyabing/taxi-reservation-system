{# âœ… éƒ¨åˆ†æ¨¡æ¿ï¼šæ˜¾ç¤ºæˆ‘çš„é¢„çº¦æŒ‰é’®ä¸çŠ¶æ€ #}

{% if user_reservation %}
  <div style="margin-top:5px;">
    <span style="color:blue;">ğŸ§ æˆ‘çš„é¢„çº¦</span><br>
    ğŸ•’ {{ user_reservation.start_time|time:"H:i" }} ~ {{ user_reservation.end_time|time:"H:i" }}

    {% if user_reservation.status == 'canceled' %}
      <br><span style="color:gray;">âš ï¸ ä½ çš„é¢„çº¦å·²å› è¶…æ—¶æœªå‡ºåº“è¢«ç³»ç»Ÿè‡ªåŠ¨å–æ¶ˆï¼Œè¯·é‡æ–°é¢„çº¦</span>

    {% elif not user_reservation.actual_departure %}
      <button onclick="confirmDeparture('{{ user_reservation.id }}')">ğŸš— å‡ºåº“</button>

    {% elif not user_reservation.actual_return %}
      <button onclick="confirmReturn('{{ user_reservation.id }}')">ğŸ…¿ï¸ å…¥åº“</button>

      {# âœ… ç®¡ç†å‘˜ï¼šå¯æ’¤é”€å‡ºåº“ #}
      {% if request.user.is_staff %}
        <br><a href="{% url 'admin_reset_departure' user_reservation.id %}">ğŸ” æ’¤é”€å‡ºåº“</a>
      {% endif %}

    {% else %}
      <br>âœ… å·²å®Œæˆå‡ºå…¥åº“

      {# âœ… ç®¡ç†å‘˜ï¼šå¯æ’¤é”€å…¥åº“ #}
      {% if request.user.is_staff %}
        <br><a href="{% url 'admin_reset_return' user_reservation.id %}">ğŸ” æ’¤é”€å…¥åº“</a>
      {% endif %}
    {% endif %}
  </div>
{% endif %}

<script>
function confirmDeparture(reservationId) {
  const confirmed = confirm("ğŸš— ç¡®å®šç°åœ¨å°±ç™»è®°â€œå‡ºåº“â€å—ï¼Ÿè¯·ç¡®è®¤ä½ å·²å‡†å¤‡å¥½å‘è½¦ã€‚");
  if (confirmed) {
    openTimePopup(reservationId, 'departure');
  }
}

function confirmReturn(reservationId) {
  const confirmed = confirm("ğŸ…¿ï¸ ç¡®å®šç°åœ¨å°±ç™»è®°â€œå…¥åº“â€å—ï¼Ÿè¯·ç¡®è®¤ä½ å·²å®Œæˆå½’è¿˜è½¦è¾†ã€‚");
  if (confirmed) {
    openTimePopup(reservationId, 'return');
  }
}
</script>
