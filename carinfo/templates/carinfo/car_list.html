{% extends "base.html" %}
{% load static %}
{% load tz %}
{% now "Y-m-d" as today_str %}
{% with today_str|date:"Y-m-d" as today %}
{% with today|add:"30" as today_plus_30 %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-4">ğŸš˜ è»Šä¸¡ä¸€è¦§</h2>

  <div class="mb-3">
    <a href="{% url 'carinfo:car_create' %}" class="btn btn-success">â• è»Šä¸¡è¿½åŠ </a>
  </div>

  <table class="table table-striped table-bordered">
    <thead class="table-light">
      <tr>
        <th>å†™çœŸ</th>
        <th>ãƒŠãƒ³ãƒãƒ¼</th>
        <th>ãƒ–ãƒ©ãƒ³ãƒ‰</th>
        <th>å‹å¼</th>
        <th>å¯¸æ³•<br>(é•·/å¹…/é«˜)</th>
        <th>çŠ¶æ…‹</th>
        <th>è²¬ä»»è€…</th>
        <th>ä¿é™ºæœŸé™</th>
        <th>æ¤œæŸ»æœŸé™</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for car_info in cars %}
        {% with car=car_info.obj %}
        <tr>
          <td>
            {% if car.image %}
              <img src="{{ car.image.url }}" style="height: 50px;">
            {% else %}-{% endif %}
          </td>
          <td>
            <a href="{% url 'carinfo:car_detail' car.pk %}">{{ car.license_plate }}</a>
          </td>
          <td>{{ car.brand }}</td>
          <td>{{ car.model }}</td>
          <td>
            {% if car.obj.length %}
              {{ car.obj.length }} Ã— {{ car.obj.width }} Ã— {{ car.obj.height }} <span class="text-muted small">mm</span>
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            {% if car.status == 'available' %}
              <span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> ä½¿ç”¨å¯</span>
            {% elif car.status == 'repair' %}
              <span class="badge bg-warning text-dark"><i class="bi bi-tools"></i> ç»´ä¿®ä¸­</span>
            {% elif car.status == 'retired' %}
              <span class="badge bg-secondary"><i class="bi bi-x-circle-fill"></i> å·²æŠ¥åºŸ</span>
            {% else %}
              <span class="badge bg-dark"><i class="bi bi-question-circle"></i> æœªè®¾å®š</span>
            {% endif %}
          </td>
          <td>{{ car.manager_name }}</td>

          <td>
            {% if car.insurance_expiry %}
              {{ car.insurance_expiry }}
              {% if car.insurance_expiry|stringformat:"s" <= today_plus_30|stringformat:"s" %}
                <span class="text-danger">âš ï¸</span>
              {% endif %}
            {% else %}-{% endif %}
          </td>

          <td>
            {% if car.inspection_date %}
              {{ car.inspection_date }}
              {% if car.get_inspection_reminder %}
                <div class="text-danger small mt-1">
                  {{ car.get_inspection_reminder }}
                </div>
              {% endif %}
            {% else %}
              -
            {% endif %}
          </td>

          <td>
            <a href="{% url 'carinfo:car_edit' car.pk %}" class="btn btn-sm btn-outline-primary">âœï¸ ç·¨é›†</a>
            <a href="{% url 'carinfo:car_delete' car.pk %}" class="btn btn-sm btn-outline-danger">ğŸ—‘ï¸ å‰Šé™¤</a>
          </td>
        </tr>
        {% endwith %}
      {% empty %}
        <tr><td colspan="9" class="text-center">ğŸš« ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
{% endwith %}
{% endwith %}
