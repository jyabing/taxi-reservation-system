{% extends 'base.html' %}
{% load static %}
{% block content %}

{% include 'vehicles/status_tab_navigation.html' %}

<h2>è½¦è¾†é¢„çº¦çŠ¶æ€ä¸€è§ˆï¼ˆ{{ selected_date }}ï¼‰</h2>

<form method="get">
  é€‰æ‹©æ—¥æœŸï¼š<input type="date" name="date" value="{{ selected_date }}">
  <button type="submit">æŸ¥è¯¢</button>
</form>

<table border="1">
  <tr>
    <th>è½¦ç‰Œå·</th>
    <th>è½¦å‹</th>
    <th>çŠ¶æ€</th>
  </tr>
  {% for vehicle, info in status_map.items %}
  <tr>
    <td>
      <a href="{% url 'vehicle_detail' vehicle.id %}">
        {{ vehicle.license_plate }}
      </a>
    </td>
    <td>{{ vehicle.model }}</td>
<td>
  {% if vehicle.status == 'maintenance' %}
    <span style="color:purple; font-weight:bold;">ğŸ› ï¸ ç»´ä¿®ä¸­</span>
  {% else %}
    {% if info.status == 'available' or not info.status %}
      <a href="{% url 'make_reservation' vehicle.id %}?date={{ selected_date }}" style="color:red; font-weight:bold;">
        ğŸŸ¥ å¯é¢„çº¦ï¼ˆç‚¹å‡»é¢„çº¦ï¼‰
      </a>
    {% else %}
      {% if info.status == 'out' %}
        <span style="color:orange; font-weight:bold;">ğŸŸ§ å‡ºåº“ä¸­</span>
      {% else %}
        {% if info.status == 'reserved' %}
          <span style="color:blue; font-weight:bold;">ğŸŸ¦ æœ‰é¢„çº¦ï¼ˆä½†æœªå‡ºåº“ï¼‰</span>
        {% else %}
          {% if info.status == 'canceled' %}
            <span style="color:gray;">âŒ å·²è‡ªåŠ¨å–æ¶ˆ</span>
          {% else %}
            <a href="{% url 'make_reservation' vehicle.id %}?date={{ selected_date }}" style="color:red; font-weight:bold;">
              ğŸŸ¥ å¯é¢„çº¦ï¼ˆç‚¹å‡»é¢„çº¦ï¼‰
            </a>
          {% endif %}
        {% endif %}
      {% endif %}
    {% endif %}
  {% endif %}

  {# æˆ‘çš„é¢„çº¦è¯¦æƒ…/å‡ºå…¥åº“æ“ä½œä¸å˜ #}
  {% if info.user_reservation %}
    <div style="margin-top:5px;">
      <span style="color:blue;">ğŸ§ æˆ‘çš„é¢„çº¦</span><br>
      ğŸ•’ {{ info.user_reservation.start_time|time:"H:i" }} ~ {{ info.user_reservation.end_time|time:"H:i" }}

      {% if not info.user_reservation.actual_departure %}
        <br>
        <button onclick="openTimePopup('{{ info.user_reservation.id }}','departure')">
          ğŸš— å‡ºåº“
        </button>
      {% elif not info.user_reservation.actual_return %}
        <br>
        <button onclick="openTimePopup('{{ info.user_reservation.id }}','return')">
          ğŸ…¿ï¸ å…¥åº“
        </button>
      {% else %}
        <br>âœ… å·²å®Œæˆå‡ºå…¥åº“
      {% endif %}
    </div>
  {% endif %}
</td>

  </tr>
  {% endfor %}
</table>

{# åªåœ¨é¡µé¢åº•éƒ¨ include å¼¹çª—æ¨¡æ¿ #}
{% include 'partials/_check_io_popup.html' %}

{% endblock %}
