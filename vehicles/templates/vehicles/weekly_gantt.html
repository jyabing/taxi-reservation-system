{% extends "base.html" %}
{% load static %}
{% load dict_helpers %}
{% block content %}

<div class="container-fluid py-3">
  <div class="d-flex align-items-center mb-3">
    <div class="me-3 d-flex align-items-baseline gap-2">
      <span class="fs-5">ğŸš—</span>
      <h6 class="mb-0 fw-semibold">ä¸€å‘¨é¢„çº¦ç”˜ç‰¹å›¾</h6>
      <span class="text-muted small">ï¼ˆ{{ week_start }} ã€œ {{ week_end }}ï¼‰</span>
    </div>
    <div class="ms-auto d-flex gap-2">
      <a class="btn btn-outline-secondary btn-sm" href="?start={{ prev_week|date:'Y-m-d' }}">å‰é€±</a>
      <a class="btn btn-primary btn-sm" href="?start={{ this_week|date:'Y-m-d' }}">æœ¬é€±</a>
      <a class="btn btn-outline-secondary btn-sm" href="?start={{ next_week|date:'Y-m-d' }}">æ¬¡é€±</a>
    </div>
  </div>

  <!-- å‡¡ä¾‹ï¼ˆçŠ¶æ€è¯´æ˜ï¼‰ -->
  <!-- Legend æ ·å¼ï¼ˆå†…è”ï¼Œç¡®ä¿ç«‹å³ç”Ÿæ•ˆï¼›ä¹‹åå¯ç§»å…¥ CSS æ–‡ä»¶ï¼‰ -->
    <style>
    .legend-box{display:inline-block;width:16px;height:12px;margin-right:4px;border-radius:3px;vertical-align:middle;}
    </style>

   <div class="mb-2 small d-flex gap-3 align-items-center"> 
    <span><span class="legend-box gantt-reserved"></span> ç¢ºå®šæ¸ˆã¿</span>
    <span><span class="legend-box gantt-pending"></span> æ‰¿èªå¾…ã¡</span>
    <span><span class="legend-box gantt-out"></span> å‡ºåº“ä¸­</span>
    <span><span class="legend-box gantt-canceled"></span> ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>
  </div>

  <div class="gantt-wrapper">
    <!-- å åŠ ç½‘æ ¼çš„ç”»å¸ƒï¼ˆæ²¿ç”¨ static/js/gantt.js çš„é€»è¾‘ï¼‰ -->
    <canvas id="gantt-grid-overlay"></canvas>

    <table class="gantt-table jp-compact">
      <thead>
        <tr>
          <th class="sticky-col">è½¦è¾†</th>
          {# å‘¨ä¸€åˆ°å‘¨æ—¥ï¼Œå„å  24 åˆ—ï¼šè¿™é‡Œåªåšæ ‡é¢˜è¡Œï¼ŒçœŸæ­£ 24 åˆ—åœ¨ tbody ç”±ç©ºç™½/æ®µæ‹¼æ»¡ #}
          {% for d in week_dates %}
            <th colspan="24" class="text-center">{{ d|date:"Y-m-d" }}ï¼ˆ{{ d|ja_weekday }}ï¼‰</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in vehicle_rows %}
        <tr>
          <td class="sticky-col">
            {{ row.vehicle_label }}
          </td>

          {# é€æ®µæ¸²æŸ“ï¼šæ¯æ®µä¹‹å‰æ¸²æŸ“ gapï¼ˆç©ºç™½ï¼‰ï¼Œå†æ¸²æŸ“æ®µï¼›æœ€åæ¸²æŸ“å°¾éƒ¨ç©ºç™½ #}
          {% for seg in row.segs %}
            {% if seg.gap > 0 %}
              <td colspan="{{ seg.gap }}" class="gantt-empty"></td>
            {% endif %}
            <td colspan="{{ seg.length }}"
                class="gantt-seg gantt-{{ seg.status }}"
                title="{{ seg.title }}"></td>
          {% endfor %}

          {% if row.tail_gap > 0 %}
            <td colspan="{{ row.tail_gap }}" class="gantt-empty"></td>
          {% endif %}
        </tr>
        {% empty %}
        <tr>
          <td colspan="{{ 1|add:HOURS }}" class="text-center text-muted py-4">æœ¬å‘¨æš‚æ— é¢„çº¦</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  // è®©ç½‘æ ¼è„šæœ¬çŸ¥é“æ€»åˆ—æ•°ï¼ˆ168ï¼‰
  const tbl = document.querySelector('.gantt-table');
  if (tbl) tbl.setAttribute('data-hours', '{{ HOURS }}');
</script>
{% endblock %}
