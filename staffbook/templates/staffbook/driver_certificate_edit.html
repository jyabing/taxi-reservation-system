{% extends "staffbook/base_staffbook.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow" style="width:90vw;max-width:1400px;margin:0 auto;">
    <div class="card-header bg-white d-flex align-items-center" style="font-size:1.3em;">
        <i class="fa fa-user me-2"></i>
        <b>{{ driver.name }}</b>
        <span class="badge bg-primary ms-2" style="font-size:0.9em;">No.{{ driver.driver_code }}</span>
        <span class="ms-auto" style="font-size:0.95em;">
            äº‹æ¥­è€…å: {{ driver.company.name|default_if_none:""|default:"-" }}ã€€å–¶æ¥­æ‰€å: {{ driver.workplace.name|default_if_none:""|default:"-" }}
        </span>
    </div>
    <div class="card-body">

      {% include "staffbook/driver_tab_nav.html" %}

      <form method="post" class="mt-4">
        {% csrf_token %}
        {% for field in form %}
          <div class="mb-3 row align-items-center">
            <label for="{{ field.id_for_label }}" class="col-sm-2 col-form-label">{{ field.label }}</label>
            <div class="col-sm-6">
              {{ field }}
              {% if field.errors %}
                <div class="text-danger small">{{ field.errors.0 }}</div>
              {% endif %}
            </div>

            {# æç¤ºï¼šå½“ residence_status ä¸º â€œç‰¹å®šæŠ€èƒ½46å·â€ æ—¶æ˜¾ç¤º #}
            {% if field.name == 'residence_status' %}
              <div class="col-sm-4">
                <span id="skill-tip"
                      class="badge bg-info text-dark"
                      style="display:none; cursor:pointer;"
                      data-bs-toggle="tooltip"
                      title="ç‰¹å®šæŠ€èƒ½46å·ã¨ã¯ã€14åˆ†é‡ã®ç‰¹å®šæŠ€èƒ½1å·ã®ç·ç§°ã§ã™ã€‚ä»‹è­·ã€å¤–é£Ÿæ¥­ã€å®¿æ³Šæ¥­ãªã©ãŒå«ã¾ã‚Œã¾ã™ã€‚">
                  ğŸ’¡æç¤º
                </span>
              </div>
            {% endif %}
          </div>
        {% endfor %}

        <div class="text-end mt-4">
          <button type="submit" class="btn btn-primary">ä¿å­˜ã™ã‚‹</button>
          <a href="{% url 'staffbook:driver_certificate_info' driver.id %}" class="btn btn-secondary ms-2">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
        </div>
      </form>

    </div>
  </div>
</div>

{# âœ… Bootstrap 5.3 Tooltip æ”¯æŒ #}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const select = document.getElementById('id_residence_status');
  const tip = document.getElementById('skill-tip');

  if (!select || !tip) return;

  // åˆå§‹åŒ– tooltip
  const tooltip = new bootstrap.Tooltip(tip);

  // æ§åˆ¶æç¤ºæ˜¾ç¤º
  function checkStatus() {
    if (select.value === 'ç‰¹å®šæŠ€èƒ½46å·') {
      tip.style.display = 'inline-block';
    } else {
      tip.style.display = 'none';
    }
  }

  select.addEventListener('change', checkStatus);
  checkStatus();  // é¡µé¢åŠ è½½æ—¶ä¹Ÿæ£€æµ‹
});
</script>
{% endblock %}
