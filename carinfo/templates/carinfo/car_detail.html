{% extends "base.html" %}
{% load tz %}
{% now "Y-m-d" as today_str %}
{% with today_str|date:"Y-m-d" as today %}
{% with today|add:"30" as today_plus_30 %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-4">ğŸš˜ è½¦è¾†è¯¦æƒ…</h2>

  <div class="row">
    <!-- å·¦ä¾§å›¾ç‰‡ -->
    <div class="col-md-4 mb-3">
      {% if car.main_photo %}
        <img src="{{ car.main_photo.url }}" alt="è½¦è¾†å›¾ç‰‡" class="img-fluid rounded border">
      {% else %}
        <div class="border rounded p-4 text-muted text-center">æš‚æ— å›¾ç‰‡</div>
      {% endif %}
    </div>

    <!-- å³ä¾§ä¿¡æ¯ -->
    <div class="col-md-8">
      <table class="table table-bordered">
        <tr><th>è½¦è¾†åç§°</th><td>{{ car.name }}</td></tr>
        <tr><th>å“ç‰Œ / å‹å·</th><td>{{ car.brand }} / {{ car.model }}</td></tr>
        <tr>
          <th>å¯¸æ³•ï¼ˆé•· / å¹… / é«˜ï¼‰</th>
          <td>
            {% if car.length or car.width or car.height %}
              {{ car.length|default:"-" }} / {{ car.width|default:"-" }} / {{ car.height|default:"-" }} mm
            {% else %}
              -
            {% endif %}
          </td>
        </tr>
        <tr><th>è½¦ç‰Œå·</th><td>{{ car.license_plate }}</td></tr>
        <tr><th>å‡ºå‚å¹´ä»½</th><td>{{ car.year }}</td></tr>

        <tr><th>è½¦é¾„</th>
          <td>
            {% if car_age %}
              {{ car_age }} å¹´
            {% else %}
              -
            {% endif %}
          </td>
        </tr>

        <tr><th>å¹´æ£€å‘¨æœŸ</th><td>{{ inspection_cycle }}</td></tr>

        <tr><th>ä¸‹æ¬¡å¹´æ£€é¢„ä¼°</th>
          <td>
            {% if next_inspection %}
              {{ next_inspection }}
              {% if next_inspection|stringformat:"s" <= today|stringformat:"s" %}
                <span class="text-danger">âš ï¸ å·²è¿‡æœŸ</span>
              {% endif %}
            {% else %}
              -
            {% endif %}
          </td>
        </tr>

        <tr><th>ç‡ƒæ–™ç±»å‹</th><td>{{ car.fuel_type }}</td></tr>

        <tr><th>è½¦è¾†çŠ¶æ€</th>
          <td>
            {% if car.status == 'available' %}
              <span class="badge bg-success">å¯ç”¨</span>
            {% elif car.status == 'repair' %}
              <span class="badge bg-warning text-dark">ç»´ä¿®ä¸­</span>
            {% elif car.status == 'retired' %}
              <span class="badge bg-secondary">å·²æŠ¥åºŸ</span>
            {% endif %}
          </td>
        </tr>

        <tr><th>è´Ÿè´£äºº</th><td>{{ car.manager_name }}ï¼ˆ{{ car.manager_phone }}ï¼‰</td></tr>
        <tr><th>æ‰€å±éƒ¨é—¨</th><td>{{ car.department }}</td></tr>

        <tr><th>ä¿é™©åˆ°æœŸæ—¥</th>
          <td>
            {{ car.insurance_expiry }}
            {% if car.insurance_expiry and car.insurance_expiry|stringformat:"s" <= today_plus_30|stringformat:"s" %}
              <span class="text-danger">âš ï¸ å³å°†åˆ°æœŸ</span>
            {% endif %}
          </td>
        </tr>

        <tr><th>è½¦æ£€åˆ°æœŸæ—¥</th>
          <td>
            {{ car.inspection_date }}
            {% if car.inspection_date and car.inspection_date|stringformat:"s" <= today_plus_30|stringformat:"s" %}
              <span class="text-danger">âš ï¸ å³å°†åˆ°æœŸ</span>
            {% endif %}
          </td>
        </tr>

        <tr><th>ETCè®¾å¤‡ç¼–å·</th><td>{{ car.etc_device }}</td></tr>
        <tr><th>æ²¹å¡å·</th><td>{{ car.fuel_card_number }}</td></tr>
        <tr><th>GPSç¼–å·</th><td>{{ car.gps_device_id }}</td></tr>
        <tr><th>åˆ·å¡æœºç¼–å·</th><td>{{ car.pos_terminal_id }}</td></tr>
        <tr><th>å¤‡æ³¨</th><td>{{ car.notes|default:"-" }}</td></tr>
      </table>

      <div class="mt-4">
        <a href="{% url 'carinfo:car_edit' car.pk %}" class="btn btn-primary me-2">âœï¸ ç¼–è¾‘</a>
        <a href="{% url 'carinfo:car_delete' car.pk %}" class="btn btn-outline-danger me-2">ğŸ—‘ï¸ åˆ é™¤</a>
        <a href="{% url 'carinfo:car_list' %}" class="btn btn-secondary">è¿”å›åˆ—è¡¨</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% endwith %}
{% endwith %}
