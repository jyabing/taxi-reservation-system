{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
  <h4 class="mb-3">ğŸš ç§ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç¢ºèª</h4>

  <p class="text-muted small mb-3">
    {% if driver %}
      å¯¾è±¡ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ï¼š<strong>{{ driver }}</strong>
    {% else %}
      å¯¾å¿œã™ã‚‹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆç®¡ç†è€…ã«ç¢ºèªã—ã¦ãã ã•ã„ï¼‰
    {% endif %}
    {% if today and to_date %}
      ï¼ è¡¨ç¤ºæœŸé–“ï¼š{{ today|date:"Y-m-d" }} ã€œ {{ to_date|date:"Y-m-d" }}
    {% endif %}
  </p>

  <table class="table table-sm table-bordered align-middle responsive-cards">
    <thead class="table-light">
      <tr>
        <th style="width: 110px;">æ—¥ä»˜</th>
        <th style="width: 90px;">åŒºåˆ†</th>
        <th style="width: 90px;">ã‚·ãƒ•ãƒˆ</th>
        <th>è»Šä¸¡å¸Œæœ›</th>
        <th>ä¼šç¤¾æ±ºå®š</th>
        <th>å‚™è€ƒ</th>
        <th style="width: 110px;">çŠ¶æ…‹</th>
        <th style="width: 130px;">æ“ä½œ</th>  {# â† æ–°å¢ #}
      </tr>
    </thead>
    <tbody>
      {% if schedules %}
        {% for s in schedules %}
          <tr>
            <td data-label="æ—¥ä»˜">{{ s.work_date|date:"Y-m-d (D)" }}</td>
            <td data-label="åŒºåˆ†">
              {% if s.is_rest %}
                <span class="badge bg-secondary">ä¼‘ã¿</span>
              {% else %}
                <span class="badge bg-primary">å¸Œæœ›</span>
              {% endif %}
            </td>
            <td data-label="ã‚·ãƒ•ãƒˆ">
              {% if not s.is_rest %}
                {% if s.shift == "day" %}ç™½{% elif s.shift == "night" %}å¤œ{% else %}-{% endif %}
              {% else %}-{% endif %}
            </td>

            <td data-label="è»Šä¸¡å¸Œæœ›">
              {% if s.is_rest %}
                -
              {% else %}
                {% if s.any_car %}
                  ä»»æ„ã®è»Šä¸¡ã§å¯
                {% else %}
                  ç¬¬1:
                  {% if s.first_choice_car %}
                    {{ s.first_choice_car.license_plate|default:s.first_choice_car.registration_number }}
                    {{ s.first_choice_car.name }}
                  {% else %}-{% endif %}
                  <br>
                  ç¬¬2:
                  {% if s.second_choice_car %}
                    {{ s.second_choice_car.license_plate|default:s.second_choice_car.registration_number }}
                    {{ s.second_choice_car.name }}
                  {% else %}-{% endif %}
                {% endif %}
              {% endif %}
            </td>

            <td data-label="ä¼šç¤¾æ±ºå®š">
              {% if s.assigned_car %}
                <span class="badge bg-success">
                  {{ s.assigned_car.license_plate|default:s.assigned_car.registration_number }} {{ s.assigned_car.name }}
                </span>
              {% elif s.status == "approved" %}
                <span class="badge bg-info text-dark">ä¼šç¤¾æ±ºå®šæ¸ˆï¼ˆè»Šä¸¡æœªæŒ‡å®šï¼‰</span>
              {% elif s.status == "rejected" %}
                <span class="badge bg-danger">å·®ã—æˆ»ã—</span>
              {% else %}
                <span class="badge bg-secondary">ç¢ºèªä¸­</span>
              {% endif %}
              {% if s.admin_note %}
                <div class="small text-muted mt-1">{{ s.admin_note }}</div>
              {% endif %}
            </td>

            <td data-label="å‚™è€ƒ">{{ s.note|default:"-" }}</td>

            <td data-label="çŠ¶æ…‹">
              <span class="badge bg-light text-muted d-block mb-1">ä¿å­˜æ¸ˆã¿</span>
              <span class="text-muted small">{{ s.updated_at|date:"m/d H:i" }}</span>
            </td>

            {# â† æ–°å¢ï¼šæ“ä½œåˆ— #}
            <td data-label="æ“ä½œ">
              <div class="d-flex flex-wrap gap-2">
                <a
                  href="{% url 'staffbook:schedule_form' %}?work_date={{ s.work_date|date:'Y-m-d' }}"
                  class="btn btn-sm btn-outline-primary">
                  âœï¸ ç·¨é›†
                </a>

                <form method="post"
                      action="{% url 'staffbook:schedule_delete' s.id %}"
                      onsubmit="return confirm('ã“ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-outline-danger">
                    ğŸ—‘ å‰Šé™¤
                  </button>
                </form>
              </div>
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="8" class="text-center text-muted py-4">
            ã¾ã ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
          </td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% endblock %}
