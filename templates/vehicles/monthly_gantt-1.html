{% extends 'base.html' %}
{% load static custom_filters %}   {# è½½å…¥æˆ‘ä»¬æ–°å†™çš„ to_int #}
{% block content %}

<h2>ğŸš˜ {{ vehicle.license_plate }} â€” {{ vehicle.model }} Â· {{ current_month|date:"Yå¹´næœˆ" }}</h2>

<p>
  <a href="?date={{ prev_month|date:"Y-m" }}">â† ä¸Šä¸€æœˆ</a>
  |
  <a href="?date={{ next_month|date:"Y-m" }}">ä¸‹ä¸€æœˆ â†’</a>
</p>

<!-- âœ… åŒ…è£¹æ•´ä¸ªç”˜ç‰¹å›¾ -->
<div id="gantt-container" style="position: relative;">
  <!-- âœ… Canvas ç”¨äºç»˜åˆ¶å‚ç›´æ—¶é—´çº¿ -->
  <canvas id="gantt-grid-overlay" style="position:absolute; top:0; left:0; pointer-events:none;"></canvas>
<table class="gantt-table">
  <thead>
    <tr>
      <th>æ—¥æœŸ</th>
-     {% for h in hours %}
-       <th>{{ h }}æ—¶</th>
-     {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for row in matrix %}
      <tr>
        <td>{{ row.date|date:"m-d (D)" }}</td>
        {% with cursor=0 %}
          {% for seg in row.segments %}
            {% if seg.start > cursor %}
+               <td colspan="{{ seg.start|floatformat:0 }}" class="gantt-empty"></td>
            {% endif %}
+           <td colspan="{{ seg.length|floatformat:0 }}"
               class="gantt-seg gantt-{{ seg.status }}"
               title="{{ seg.label }}">
            </td>
            {% with cursor=cursor|add:seg.length %}
            {% endwith %}
          {% endfor %}
          {% if cursor < 24 %}
-           <td colspan="{{ 24|floatformat:0|add:'-cursor' }}" class="gantt-empty"></td>
          {% endif %}
        {% endwith %}
      </tr>
    {% endfor %}
  </tbody>
</table>

  
</div>
{% endblock %}